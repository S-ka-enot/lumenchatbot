# –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Coolify

## ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

- [x] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
- [x] `config/env.local` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
- [x] Dockerfile'—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –≥–æ—Ç–æ–≤—ã

## üì¶ –ü–µ—Ä–µ–¥ –ø—É—à–µ–º –Ω–∞ GitHub

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   git grep -i "password\|token\|secret\|key" config/env.local
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ (—Ñ–∞–π–ª –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**
   ```bash
   git ls-files | grep -E "\.db$|\.sqlite"
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ
   ```

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Coolify

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å—ã

#### Backend
- **–¢–∏–ø:** Dockerfile
- **Build Context:** –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (`.` –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)
- **Dockerfile Path:** `backend/Dockerfile`
- **–ü–æ—Ä—Ç:** `8000`
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
  - `ENVIRONMENT=production`
  - `DATABASE_URL=postgresql+asyncpg://...` (–∏–∑ PostgreSQL —Å–µ—Ä–≤–∏—Å–∞)
  - `SYNC_DATABASE_URL=postgresql://...` (–∏–∑ PostgreSQL —Å–µ—Ä–≤–∏—Å–∞)
  - `REDIS_URL=redis://...` (–∏–∑ Redis —Å–µ—Ä–≤–∏—Å–∞)
  - `SECRET_KEY=<—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π>`
  - `BOT_TOKEN_ENCRYPTION_KEY=<—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π>`
  - `TELEGRAM_BOT_TOKEN=<—Ç–æ–∫–µ–Ω –±–æ—Ç–∞>`
  - `YOOKASSA_SHOP_ID=<shop_id>`
  - `YOOKASSA_API_KEY=<api_key>`
  - `YOOKASSA_RETURN_URL=https://<backend-domain>/api/v1/payments/return`
  - `BACKEND_CORS_ORIGINS=["https://<frontend-domain>"]`
  - `ADMIN_SEED_USERNAME=admin` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
  - `ADMIN_SEED_PASSWORD=<–ø–∞—Ä–æ–ª—å>` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

#### Bot
- **–¢–∏–ø:** Dockerfile
- **Build Context:** –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (`.` –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)
- **Dockerfile Path:** `bot/Dockerfile`
- **–ü–æ—Ä—Ç:** –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
  - `BOT_TOKEN=<—Ç–æ–∫–µ–Ω –±–æ—Ç–∞>`
  - `BACKEND_API_BASE_URL=https://<backend-domain>/api/v1`
  - `BACKEND_API_TIMEOUT=15`

#### Frontend
- **–¢–∏–ø:** Dockerfile
- **Build Context:** `frontend/`
- **Dockerfile Path:** `Dockerfile` (–∏–ª–∏ `frontend/Dockerfile` –µ—Å–ª–∏ build context = –∫–æ—Ä–µ–Ω—å)
- **–ü–æ—Ä—Ç:** `80`
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
  - `VITE_BACKEND_API_URL=https://<backend-domain>/api/v1`

### 2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã

- **PostgreSQL:** —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å PostgreSQL 15+ –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ Backend
- **Redis:** —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å Redis 7+ –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ Backend

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω—ã

- Backend: `api.yourdomain.com` –∏–ª–∏ `backend.yourdomain.com`
- Frontend: `admin.yourdomain.com` –∏–ª–∏ `yourdomain.com`
- –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π SSL (Let's Encrypt)

## üîç –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:**
   - –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "Application startup complete"

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API:**
   ```bash
   curl https://<backend-domain>/api/v1/health
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 200
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `ADMIN_SEED_*`):
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É backend
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `python scripts/reset_admin_password_simple.py /app/backend/lumenpay.db admin <–ø–∞—Ä–æ–ª—å>`

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ frontend:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `https://<frontend-domain>`
   - –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ—Ç–∞:**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ bot —Å–µ—Ä–≤–∏—Å–∞

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –≤ production!**
- **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ `SECRET_KEY` –∏ `BOT_TOKEN_ENCRYPTION_KEY`**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL –≤–º–µ—Å—Ç–æ SQLite –≤ production**
- **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –¥–ª—è frontend –¥–æ–º–µ–Ω–∞**

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `docs/deployment/coolify.md`
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `docs/architecture-plan.md`
- –£–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã: `SYSTEM_IMPROVEMENTS.md`
- –£–ª—É—á—à–µ–Ω–∏—è UI: `UI_IMPROVEMENTS.md`

